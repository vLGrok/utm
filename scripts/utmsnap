#!/bin/bash

# Define base directories
BASE_DIR=~/Library/Containers/com.utmapp.UTM/Data/Documents
SNAPSHOTS_DIR=$BASE_DIR/Snapshots

# Create Snapshots directory if it doesn't exist
mkdir -p $SNAPSHOTS_DIR

snapshot() {
    VM_NAME=$1
    TIMESTAMP=$(date +"%Y-%m-%d-%H-%M-%S")
    SNAPSHOT_NAME="${VM_NAME}_${TIMESTAMP}.tar.gz"
    
    # Check if VM directory exists
    if [ -d "$BASE_DIR/$VM_NAME.utm" ]; then
        # Create snapshot
        tar -czvf $SNAPSHOTS_DIR/$SNAPSHOT_NAME -C $BASE_DIR $VM_NAME.utm
        echo "Snapshot created: $SNAPSHOT_NAME"
    else
        echo "VM directory $VM_NAME.utm does not exist."
    fi
}

revert() {
    echo "Revert functionality is not yet implemented."
}

# Main script
COMMAND=$1

case $COMMAND in
    create)
        if [ -z "$2" ]; then
            echo "Usage: $0 create <VM_NAME>"
        else
            snapshot $2
        fi
        ;;
    revert)
        revert
        ;;
    *)
        echo "Usage: $0 {create|revert}"
        ;;
esac

